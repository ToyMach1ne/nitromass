function PopupMenu(id,zIndex,dxShadow){var _this=this;this.menu_id=id,this.controlDiv=null,this.zIndex=100,this.dxShadow=3,this.menuItems=null,this.submenus=[],this.bDoHide=!1,this.parentItem=null,this.parentMenu=null,this.submenuIndex=null,this.bHasSubmenus=!1,this.OnClose=null,isNaN(zIndex)||(this.zIndex=zIndex),isNaN(dxShadow)||(this.dxShadow=dxShadow),this.Create=function(e,t){isNaN(e)||(this.zIndex=e),isNaN(t)||(this.dxShadow=t);var s=document.createElement("DIV");s.id=this.menu_id,s.className="bx-popup-menu",s.style.position="absolute",s.style.zIndex=this.zIndex,s.style.left="-1000px",s.style.top="-1000px",s.style.visibility="hidden",s.onclick=_this.PreventDefault,document.body.appendChild(s),s.innerHTML='<table cellpadding="0" cellspacing="0" border="0"><tr><td class="popupmenu"><table cellpadding="0" cellspacing="0" border="0" id="'+this.menu_id+'_items"><tr><td></td></tr></table></td></tr></table>'},this.ClearItemsStyle=function(){for(var e=document.getElementById(this.menu_id+"_items"),t=0;t<e.rows.length;t++){var s=jsUtils.FindChildObject(e.rows[t].cells[0],"div");if(s&&s.className.indexOf("popupitemover")!=-1){s.className=s.className.replace(/\s*popupitemover/i,"");break}}},this.PopupShow=function(e){var t=document.getElementById(this.menu_id);t||(this.BuildItems(),t=document.getElementById(this.menu_id)),this.ClearItemsStyle(),setTimeout(function(){jsUtils.addEvent(document,"click",_this.CheckClick)},10),jsUtils.addEvent(document,"keypress",_this.OnKeyPress);var s=t.offsetWidth,i=t.offsetHeight;e=jsUtils.AlignToPos(e,s,i),t.style.width=s+"px",t.style.visibility="visible",jsFloatDiv.Show(t,e.left,e.top,this.dxShadow,!1),t.ondrag=jsUtils.False,t.onselectstart=jsUtils.False,t.style.MozUserSelect="none"},this.PopupHide=function(){for(var e=0,t=this.submenus.length;e<t;e++)this.submenus[e]&&this.submenus[e].IsVisible()&&this.submenus[e].PopupHide();this.parentMenu&&(this.parentMenu.submenuIndex=null);var s=document.getElementById(this.menu_id);s&&(jsFloatDiv.Close(s),s.style.visibility="hidden"),this.OnClose&&this.OnClose(),this.controlDiv=null,jsUtils.removeEvent(document,"click",_this.CheckClick),jsUtils.removeEvent(document,"keypress",_this.OnKeyPress)},this.CheckClick=function(e){for(var t=0,s=_this.submenus.length;t<s;t++)if(_this.submenus[t]&&!_this.submenus[t].CheckClick(e))return!1;var i=document.getElementById(_this.menu_id);if(!i)return!0;if("visible"!=i.style.visibility)return!0;var n=jsUtils.GetWindowScrollPos(),u=e.clientX+n.scrollLeft,m=e.clientY+n.scrollTop,o=parseInt(i.style.left),l=parseInt(i.style.top),d=o+parseInt(i.offsetWidth),h=l+parseInt(i.offsetHeight);if(u>=o&&u<=d&&m>=l&&m<=h)return!1;if(_this.controlDiv){var r=jsUtils.GetRealPos(_this.controlDiv);if(u>=r.left&&u<=r.right&&m>=r.top&&m<=r.bottom)return!1}return _this.PopupHide(),!0},this.OnKeyPress=function(e){e||(e=window.event),e&&27==e.keyCode&&_this.PopupHide()},this.PreventDefault=function(e){return e||(e=window.event),e.stopPropagation?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1),!1},this.GetItemIndex=function(e){var t=_this.menu_id+"_item_",s=parseInt(e.id.substr(t.length));return s},this.ShowSubmenu=function(item,bMouseOver,bDontShow){item||(item=this);var item_index=_this.GetItemIndex(item);if(1==bMouseOver){if(!_this.menuItems[item_index].__time)return;var dxTime=(new Date).valueOf()-_this.menuItems[item_index].__time;if(dxTime<500)return}var menu;if(_this.submenus[item_index]?menu=_this.submenus[item_index]:(menu=new PopupMenu(_this.menu_id+"_sub_"+item_index),menu.Create(_this.zIndex+10,_this.dxShadow),menu.SetItems(_this.menuItems[item_index].MENU),menu.BuildItems(),menu.parentItem=document.getElementById(_this.menu_id+"_item_"+item_index),menu.parentMenu=_this,menu.OnClose=function(){jsUtils.addEvent(document,"keypress",_this.OnKeyPress)},_this.submenus[item_index]=menu,_this.menuItems[item_index].ONMENUPOPUP&&eval(_this.menuItems[item_index].ONMENUPOPUP)),_this.submenuIndex=item_index,!menu.IsVisible()&&1!=bDontShow){var item_pos=jsUtils.GetRealPos(item),menu_pos=jsUtils.GetRealPos(document.getElementById(_this.menu_id)),pos={left:menu_pos.right-1,right:menu_pos.left+1,top:item_pos.bottom+1,bottom:item_pos.top};jsUtils.removeEvent(document,"keypress",_this.OnKeyPress),menu.controlDiv=item,menu.PopupShow(pos)}},this.OnSubmenuMouseOver=function(){_this.OnItemMouseOver(this);var e=_this.GetItemIndex(this);_this.menuItems[e].__time||(_this.menuItems[e].__time=(new Date).valueOf());var t=this;setTimeout(function(){_this.ShowSubmenu(t,!0)},550)},this.OnItemMouseOver=function(e){_this.bHasSubmenus&&_this.ClearItemsStyle();var t=e?e:this;if(t.className="popupitem popupitemover",_this.parentItem&&(_this.bDoHide=!1,"popupitem popupitemover"!=_this.parentItem.className&&(_this.parentMenu.ClearItemsStyle(),_this.parentItem.className="popupitem popupitemover")),null!=_this.submenuIndex){var s=_this.GetItemIndex(t);_this.submenuIndex!=s&&_this.submenus[_this.submenuIndex]&&(_this.submenus[_this.submenuIndex].bDoHide=!0,setTimeout(function(){_this.HideSubmenu()},500))}},this.OnSubmenuMouseOut=function(){var e=_this.GetItemIndex(this);_this.menuItems[e].__time=null},this.OnItemMouseOut=function(){this.className="popupitem"},this.HideSubmenu=function(){null!=_this.submenuIndex&&1==_this.submenus[_this.submenuIndex].bDoHide&&_this.submenus[_this.submenuIndex].PopupHide()},this.SetItems=function(e){this.menuItems=e,this.submenus=[]},this.SetItemIcon=function(e,t){if("string"==typeof e||e instanceof String){for(var s in this.menuItems)if(this.menuItems[s].ID&&this.menuItems[s].ID==e){this.menuItems[s].ICONCLASS=t;var i=document.getElementById(e);if(i){var n=jsUtils.FindChildObject(i,"div");n&&(n.className="icon "+t)}break}}else{var n=jsUtils.FindChildObject(jsUtils.FindChildObject(e,"td","gutter",!0),"div");n&&(this.menuItems[this.GetItemIndex(e)].ICONCLASS=t,n.className="icon "+t)}},this.SetAllItemsIcon=function(e){for(var t=0,s=this.menuItems.length;t<s;t++){var i=document.getElementById(this.menu_id+"_item_"+t),n=jsUtils.FindChildObject(jsUtils.FindChildObject(i,"td","gutter",!0),"div");n&&(this.menuItems[t].ICONCLASS=e,n.className="icon "+e)}},this.BuildItems=function(){var e=this.menuItems;if(e&&0!=e.length){var t=document.getElementById(this.menu_id);t||(this.Create(),t=document.getElementById(this.menu_id)),t.style.left="-1000px",t.style.top="-1000px",t.style.width="auto",this.bHasSubmenus=!1;for(var s=document.getElementById(this.menu_id+"_items");s.rows.length>0;)s.deleteRow(0);for(var i=e.length,n=0;n<i;n++){var u=s.insertRow(-1),m=u.insertCell(-1);if(e[n].CLASS&&(u.className=e[n].CLASS),e[n].SEPARATOR)m.innerHTML='<div class="popupseparator"><div class="empty"></div></div>';else{var o='<div id="'+this.menu_id+"_item_"+n+'" class="popupitem"'+(1!=e[n].DISABLED&&e[n].ONCLICK?" "+(e[n].MENU?"ondblclick":"onclick")+'="'+jsUtils.htmlspecialchars(e[n].ONCLICK)+'"':"")+'>\t<div style="width:100%;"><table style="width:100% !important" cellpadding="0" cellspacing="0" border="0" dir="ltr">\t\t<tr>\t\t\t<td class="gutter"'+(e[n].ID?' id="'+e[n].ID+'"':"")+'><div class="icon'+(e[n].ICONCLASS?" "+e[n].ICONCLASS:"")+'"'+(e[n].IMAGE?' style="background-image:url('+e[n].IMAGE+');"':"")+'></div></td>\t\t\t<td class="item'+(1==e[n].DISABLED?" disabled":"")+(1==e[n].DEFAULT?" default":"")+'"'+(e[n].TITLE?' title="'+e[n].TITLE+'"':"")+">"+e[n].TEXT+"</td>";if(e[n].MENU&&(o+='<td class="arrow"></td>'),o+="\t\t</tr>\t</table></div></div>",m.innerHTML=o,1!=e[n].DISABLED){var l=jsUtils.FindChildObject(m,"div");e[n].MENU?(l.onclick=function(){_this.ShowSubmenu(this)},l.onmouseover=_this.OnSubmenuMouseOver,l.onmouseout=_this.OnSubmenuMouseOut,this.bHasSubmenus=!0):(l.onmouseover=function(){_this.OnItemMouseOver(this)},l.onmouseout=_this.OnItemMouseOut,!e[n].ONCLICK||null!=e[n].AUTOHIDE&&1!=e[n].AUTOHIDE||jsUtils.addEvent(l,"click",function(){_this.PopupHide()}))}e[n].__id=this.menu_id+"_item_"+n}}t.style.width=s.parentNode.offsetWidth}},this.GetItemInfo=function(e){var t=jsUtils.FindChildObject(e,"td","item",!0);if(t){var s="",i=jsUtils.FindChildObject(jsUtils.FindChildObject(e,"td","gutter",!0),"div");return i.className.length>5&&(s=i.className.substr(5)),{TEXT:t.innerHTML,TITLE:t.title,ICON:s}}return null},this.GetMenuByItemId=function(e){for(var t=0,s=this.menuItems.length;t<s;t++)if(this.menuItems[t].__id&&this.menuItems[t].__id==e)return this;for(var i,t=0,s=this.submenus.length;t<s;t++)if(this.submenus[t]&&0!=(i=this.submenus[t].GetMenuByItemId(e)))return i;return!1},this.IsVisible=function(){var e=document.getElementById(this.menu_id);return!!e&&"hidden"!=e.style.visibility},this.ShowMenu=function(e,t,s,i,n){if(this.controlDiv==e)this.PopupHide();else{this.IsVisible()&&this.PopupHide(),t&&(this.SetItems(t),this.BuildItems()),e.className+=" pressed bx-pressed";var u=window.BX?BX.pos(e):jsUtils.GetRealPos(e);if(i?(u.left+=i.left,u.right+=i.right,u.top+=i.top,u.bottom+=i.bottom):u.bottom+=2,1==s&&!jsUtils.IsIE()){var m=jsUtils.GetWindowScrollPos();u.top+=m.scrollTop,u.bottom+=m.scrollTop,u.left+=m.scrollLeft,u.right+=m.scrollLeft}this.controlDiv=e,this.OnClose=function(){e.className=e.className.replace(/\s*pressed bx-pressed/gi,""),n&&n()},this.PopupShow(u)}}}
//# sourceMappingURL=maps/popup_menu.js.map
