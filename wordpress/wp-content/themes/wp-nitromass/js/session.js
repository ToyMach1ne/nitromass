function CBXSession(){var e=this;this.mess={},this.timeout=null,this.sessid=null,this.bShowMess=!0,this.dateStart=new Date,this.dateInput=new Date,this.dateCheck=new Date,this.activityInterval=0,this.notifier=null,this.Expand=function(t,i,s,n){this.timeout=t,this.sessid=i,this.bShowMess=s,this.key=n,BX.ready(function(){BX.bind(document,"keypress",e.OnUserInput),BX.bind(document.body,"mousemove",e.OnUserInput),BX.bind(document.body,"click",e.OnUserInput),setTimeout(e.CheckSession,1e3*(e.timeout-60))})},this.OnUserInput=function(){var t=new Date;e.dateInput.setTime(t.valueOf())},this.CheckSession=function(){var t=new Date;if(!(t.valueOf()-e.dateCheck.valueOf()<3e4)){e.activityInterval=Math.round((e.dateInput.valueOf()-e.dateStart.valueOf())/1e3),e.dateStart.setTime(e.dateInput.valueOf());var i=e.activityInterval>e.timeout?e.timeout-60:e.activityInterval;BX.ajax.get("/bitrix/tools/public_session.php?sessid="+e.sessid+"&interval="+i+"&k="+e.key,function(t){e.CheckResult(t)})}},this.CheckResult=function(t){if("SESSION_EXPIRED"==t){if(e.bShowMess){e.notifier=document.body.appendChild(BX.create("DIV",{props:{className:"bx-session-message"},style:{top:"-1000px"},html:'<a class="bx-session-message-close" href="javascript:bxSession.Close()"></a>'+e.mess.messSessExpired}));var i=BX.GetWindowScrollPos(),s=BX.GetWindowInnerSize();e.notifier.style.left=parseInt(i.scrollLeft+s.innerWidth/2-parseInt(e.notifier.clientWidth)/2)+"px";var n=i.scrollTop-e.notifier.offsetHeight,o=i.scrollTop;new BX.fx({time:.5,step:.01,type:"accelerated",start:n,finish:o,callback:function(t){e.notifier.style.top=t+"px"},callback_complete:function(){BX.browser.IsIE()?BX.bind(window,"scroll",function(){var t=BX.GetWindowScrollPos();e.notifier.style.top=t.scrollTop+"px"}):(e.notifier.style.top="0px",e.notifier.style.position="fixed")}}).start()}}else{var a;a="SESSION_CHANGED"==t?e.timeout-60:e.activityInterval<60?60:e.activityInterval>e.timeout?e.timeout-60:e.activityInterval;var l=new Date;e.dateCheck.setTime(l.valueOf()),setTimeout(e.CheckSession,1e3*a)}},this.Close=function(){this.notifier.style.display="none"}}var bxSession=new CBXSession;
//# sourceMappingURL=maps/session.js.map
