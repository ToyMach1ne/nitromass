!function(a){if(!a.BX.ajax){var e=a.BX,t={},o={method:"GET",dataType:"html",timeout:0,async:!0,processData:!0,scriptsRunFirst:!1,emulateOnload:!0,start:!0,cache:!0,preparePost:!0,headers:!1,lsTimeout:30,lsForce:!1},r=null,n={},s={url_utf:/[^\034-\254]+/g,script_self:/\/bitrix\/js\/main\/core\/core(_ajax)*.js$/i,script_self_window:/\/bitrix\/js\/main\/core\/core_window.js$/i,script_self_admin:/\/bitrix\/js\/main\/core\/core_admin.js$/i,script_onload:/window.onload/g};e.ajax=function(a){var r;if(!a||!a.url||!e.type.isString(a.url))return!1;for(var n in t)"undefined"==typeof a[n]&&(a[n]=t[n]);t={};for(var n in o)"undefined"==typeof a[n]&&(a[n]=o[n]);if(a.method=a.method.toUpperCase(),e.localStorage||(a.lsId=null),e.browser.IsIE()){var i=s.url_utf.exec(a.url);if(i)do a.url=a.url.replace(i,e.util.urlencode(i)),i=s.url_utf.exec(a.url);while(i)}a.cache||"GET"!=a.method||(a.url=e.ajax._uncache(a.url)),"POST"==a.method&&a.preparePost&&(a.data=e.ajax.prepareData(a.data));var u=!0;if(a.lsId&&!a.lsForce){var l=e.localStorage.get("ajax-"+a.lsId);if(null!==l){u=!1;var c=function(t){if(t.key=="ajax-"+a.lsId&&"BXAJAXWAIT"!=t.value){var o=t.value,r=!!t.oldValue&&null==o;r?a.onfailure&&a.onfailure("timeout"):e.ajax.__run(a,o),e.removeCustomEvent("onLocalStorageChange",c)}};"BXAJAXWAIT"==l?e.addCustomEvent("onLocalStorageChange",c):setTimeout(function(){c({key:"ajax-"+a.lsId,value:l})},10)}}if(u){if(a.xhr=e.ajax.xhr(),!a.xhr)return;if(a.lsId&&e.localStorage.set("ajax-"+a.lsId,"BXAJAXWAIT",a.lsTimeout),a.xhr.open(a.method,a.url,a.async),"POST"==a.method&&a.preparePost&&a.xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),"object"==typeof a.headers)for(var n=0;n<a.headers.length;n++)a.xhr.setRequestHeader(a.headers[n].name,a.headers[n].value);var h=!1,d=a.xhr.onreadystatechange=function(t){if(!h)if("timeout"===t)a.onfailure&&a.onfailure("timeout"),e.onCustomEvent(a.xhr,"onAjaxFailure",["timeout","",a]),a.xhr.onreadystatechange=e.DoNothing,a.xhr.abort(),a.async&&(a.xhr=null);else if(4==a.xhr.readyState||"run"==t){if(r=e.ajax.xhrSuccess(a.xhr)?"success":"error",h=!0,a.xhr.onreadystatechange=e.DoNothing,"success"==r){var o=a.xhr.responseText;a.lsId&&e.localStorage.set("ajax-"+a.lsId,o,a.lsTimeout),e.ajax.__run(a,o)}else a.onfailure&&(a.onfailure("status",a.xhr.status),e.onCustomEvent(a.xhr,"onAjaxFailure",["status",a.xhr.status,a]));a.async&&(a.xhr=null)}};return a.async&&a.timeout>0&&setTimeout(function(){a.xhr&&!h&&d("timeout")},1e3*a.timeout),a.start&&(a.xhr.send(a.data),a.async||d("run")),a.xhr}},e.ajax.xhr=function(){if(a.XMLHttpRequest)try{return new XMLHttpRequest}catch(e){}else if(a.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("This browser does not support XMLHttpRequest.")}return null},e.ajax.__prepareOnload=function(t){if(t.length>0){e.ajax["onload_"+r]=null;for(var o=0,n=t.length;o<n;o++)t[o].isInternal&&(t[o].JS=t[o].JS.replace(s.script_onload,"BX.ajax.onload_"+r))}e.CaptureEventsGet(),e.CaptureEvents(a,"load")},e.ajax.__runOnload=function(){null!=e.ajax["onload_"+r]&&(e.ajax["onload_"+r].apply(a),e.ajax["onload_"+r]=null);var t=e.CaptureEventsGet();if(t)for(var o=0;o<t.length;o++)t[o].apply(a)},e.ajax.__run=function(a,t){a.processData?t=e.ajax.processRequestData(t,a):(a.onsuccess&&a.onsuccess(t),e.onCustomEvent(a.xhr,"onAjaxSuccess",[t,a]))},e.ajax._onParseJSONFailure=function(a){this.jsonFailure=!0,this.jsonResponse=a,this.jsonProactive=/^\[WAF\]/.test(a)},e.ajax.processRequestData=function(a,t){var o,n=[],s=[];switch(t.dataType.toUpperCase()){case"JSON":e.addCustomEvent(t.xhr,"onParseJSONFailure",e.proxy(e.ajax._onParseJSONFailure,t)),o=e.parseJSON(a,t.xhr),e.removeCustomEvent(t.xhr,"onParseJSONFailure",e.proxy(e.ajax._onParseJSONFailure,t));break;case"SCRIPT":n.push({isInternal:!0,JS:a,bRunFirst:t.scriptsRunFirst}),t.processScriptsConsecutive=!0,o=a;break;default:var i=e.processHTML(a,t.scriptsRunFirst);o=i.HTML,n=i.SCRIPT,s=i.STYLE}var u=!1;null==r&&(r=parseInt(1e6*Math.random()),u=!0),s.length>0&&e.loadCSS(s),t.emulateOnload&&e.ajax.__prepareOnload(n);var l=e.DoNothing;(t.emulateOnload||u)&&(l=e.defer(function(){t.emulateOnload&&e.ajax.__runOnload(),u&&(r=null)}));try{if(t.jsonFailure)throw{type:"json_failure",data:t.jsonResponse,bProactive:t.jsonProactive};t.scripts=n,e.ajax.processScripts(t.scripts,!0),t.onsuccess&&t.onsuccess(o),e.onCustomEvent(t.xhr,"onAjaxSuccess",[o,t]),t.processScriptsConsecutive?(e.ajax.processScriptsConsecutive(t.scripts,!1),l()):e.ajax.processScripts(t.scripts,!1,l)}catch(c){t.onfailure&&t.onfailure("processing",c),e.onCustomEvent(t.xhr,"onAjaxFailure",["processing",c,t])}},e.ajax.processScripts=function(a,t,o){var r=[],n="";o=o||e.DoNothing;for(var s=0,i=a.length;s<i;s++)"undefined"!=typeof t&&t!=!!a[s].bRunFirst||(a[s].isInternal?n+=";"+a[s].JS:r.push(a[s].JS));r=e.util.array_unique(r);var u=l1=r.length,l=n.length>0?function(){e.evalGlobal(n)}:e.DoNothing;if(u>0)for(var c=function(){--l1<=0&&(l(),o(),l=e.DoNothing)},s=0;s<u;s++)e.loadScript(r[s],c);else l(),o()},e.ajax.processScriptsConsecutive=function(a,t){for(var o=0,r=a.length;o<r;o++)null!=t&&t!=!!a[o].bRunFirst||(a[o].isInternal?e.evalGlobal(a[o].JS):e.ajax.loadScriptAjax([a[o].JS]))},e.ajax.prepareData=function(a,t){var o="";if(e.type.isString(a))o=a;else if(null!=a)for(var r in a)if(a.hasOwnProperty(r)){o.length>0&&(o+="&");var n=e.util.urlencode(r);t&&(n=t+"["+n+"]"),o+="object"==typeof a[r]?e.ajax.prepareData(a[r],n):n+"="+e.util.urlencode(a[r])}return o},e.ajax.xhrSuccess=function(a){return a.status>=200&&a.status<300||304===a.status||1223===a.status||0===a.status},e.ajax.Setup=function(a,e){e=!!e;for(var r in a)e?t[r]=a[r]:o[r]=a[r]},e.ajax.replaceLocalStorageValue=function(a,t,o){e.localStorage&&e.localStorage.set("ajax-"+a,t,o)},e.ajax._uncache=function(a){return a+((a.indexOf("?")!==-1?"&":"?")+"_="+(new Date).getTime())},e.ajax.get=function(a,t,o){return e.type.isFunction(t)&&(o=t,t=""),t=e.ajax.prepareData(t),t&&(a+=(a.indexOf("?")!==-1?"&":"?")+t,t=""),e.ajax({method:"GET",dataType:"html",url:a,data:"",onsuccess:o})},e.ajax.getCaptcha=function(a){return e.ajax.loadJSON("/bitrix/tools/ajax_captcha.php",a)},e.ajax.insertToNode=function(a,o){if(o=e(o)){e.onCustomEvent("onAjaxInsertToNode",[{url:a,node:o}]);var r=null;return t.denyShowWait||(r=e.showWait(o),delete t.denyShowWait),e.ajax.get(a,function(a){o.innerHTML=a,e.closeWait(o,r)})}},e.ajax.post=function(a,t,o){return t=e.ajax.prepareData(t),e.ajax({method:"POST",dataType:"html",url:a,data:t,onsuccess:o})},e.ajax.loadScriptAjax=function(a,t,o){if(e.type.isArray(a))for(var r=0,i=a.length;r<i;r++)e.ajax.loadScriptAjax(a[r],t,o);else{var u=a.replace(/\.js\?.*/,".js");if(s.script_self.test(u))return;if(s.script_self_window.test(u)&&e.CWindow)return;if(s.script_self_admin.test(u)&&e.admin)return;if("undefined"==typeof n[u])return o?(n[u]="",e.loadScript(a)):e.ajax({url:a,method:"GET",dataType:"script",processData:!0,emulateOnload:!1,scriptsRunFirst:!0,async:!1,start:!0,onsuccess:function(a){n[u]=a,t&&t(a)}});t&&t(n[u])}},e.ajax.loadJSON=function(a,t,o,r){return e.type.isFunction(t)&&(r=o,o=t,t=""),t=e.ajax.prepareData(t),t&&(a+=(a.indexOf("?")!==-1?"&":"?")+t,t=""),e.ajax({method:"GET",dataType:"json",url:a,onsuccess:o,onfailure:r})},e.ajax.load=function(a,t){e.type.isArray(a)||(a=[a]);var o=0;e.type.isFunction(t)||(t=e.DoNothing);for(var r=function(a){e.type.isFunction(this.callback)&&this.callback(a),++o>=s&&t()},n=0,s=a.length;n<s;n++)switch(a.type.toUpperCase()){case"SCRIPT":e.loadScript([a[n].url],jsBX.proxy(r,a[n]));break;case"CSS":e.loadCSS([a[n].url]),++o>=s&&t();break;case"JSON":e.ajax.loadJSON(a.url,jsBX.proxy(r,a[n]));break;default:e.ajax.get(a.url,"",jsBX.proxy(r,a[n]))}},e.ajax.submit=function(a,t){if(!a.target){if(null==a.BXFormTarget){var o="formTarget_"+Math.random();a.BXFormTarget=document.body.appendChild(e.create("IFRAME",{props:{name:o,id:o,src:"javascript:void(0)"},style:{display:"none"}}))}a.target=a.BXFormTarget.name}return a.BXFormCallback=t,e.bind(a.BXFormTarget,"load",e.proxy(e.ajax._submit_callback,a)),e.submit(a),!1},e.ajax.submitComponentForm=function(t,o,r){if(!t.target){if(null==t.BXFormTarget){var n="formTarget_"+Math.random();t.BXFormTarget=document.body.appendChild(e.create("IFRAME",{props:{name:n,id:n,src:"javascript:void(0)"},style:{display:"none"}}))}t.target=t.BXFormTarget.name}if(r)var s=e.showWait(o);return t.BXFormCallback=function(t){r&&e.closeWait(s),e(o).innerHTML=t,a.bxcompajaxframeonload&&setTimeout("window.bxcompajaxframeonload();window.bxcompajaxframeonload=null;",10),e.onCustomEvent("onAjaxSuccess",[])},e.bind(t.BXFormTarget,"load",e.proxy(e.ajax._submit_callback,t)),!0},e.ajax._submit_callback=function(){try{if(0!=this.BXFormTarget.contentWindow.location.href.indexOf("http"))return}catch(a){return}this.BXFormCallback&&this.BXFormCallback.apply(this,[this.BXFormTarget.contentWindow.document.body.innerHTML]),e.unbindAll(this.BXFormTarget)},e.ajax.submitAjax=function(a,e){},e.ajax.UpdatePageData=function(a){if(a.TITLE&&e.ajax.UpdatePageTitle(a.TITLE),a.NAV_CHAIN&&e.ajax.UpdatePageNavChain(a.NAV_CHAIN),a.CSS&&a.CSS.length>0&&e.loadCSS(a.CSS),a.SCRIPTS&&a.SCRIPTS.length>0){var t=function(o,r){if(r&&e.type.isArray(r.scripts))for(var n=0,s=a.SCRIPTS.length;n<s;n++)r.scripts.push({isInternal:!1,JS:a.SCRIPTS[n]});else e.loadScript(a.SCRIPTS);e.removeCustomEvent("onAjaxSuccess",t)};e.addCustomEvent("onAjaxSuccess",t)}},e.ajax.UpdatePageTitle=function(a){var t=e("pagetitle");t&&(t.removeChild(t.firstChild),t.firstChild?t.insertBefore(document.createTextNode(a),t.firstChild):t.appendChild(document.createTextNode(a))),document.title=a},e.ajax.UpdatePageNavChain=function(a){var t=e("navigation");t&&(t.innerHTML=a)},e.userOptions={options:null,bSend:!1,delay:5e3},e.userOptions.save=function(a,t,o,r,n){null==e.userOptions.options&&(e.userOptions.options={}),n=!!n,e.userOptions.options[a+"."+t+"."+o]=[a,t,o,r,n];var s=e.userOptions.__get();""!=s&&(document.cookie=e.message("COOKIE_PREFIX")+"_LAST_SETTINGS="+s+"&sessid="+e.bitrix_sessid()+"; expires=Thu, 31 Dec 2020 23:59:59 GMT; path=/;"),e.userOptions.bSend||(e.userOptions.bSend=!0,setTimeout(function(){e.userOptions.send(null)},e.userOptions.delay))},e.userOptions.send=function(a){var t=e.userOptions.__get();e.userOptions.options=null,e.userOptions.bSend=!1,""!=t&&(document.cookie=e.message("COOKIE_PREFIX")+"_LAST_SETTINGS=; path=/;",e.ajax({method:"GET",dataType:"html",processData:!1,cache:!1,url:"/bitrix/admin/user_options.php?"+t+"&sessid="+e.bitrix_sessid(),onsuccess:a}))},e.userOptions.del=function(a,t,o,r){e.ajax.get("/bitrix/admin/user_options.php?action=delete&c="+a+"&n="+t+(1==o?"&common=Y":"")+"&sessid="+e.bitrix_sessid(),r)},e.userOptions.__get=function(){if(!e.userOptions.options)return"";var a,t,o="",r=-1,n="";for(t in e.userOptions.options)a=e.userOptions.options[t],n!=a[0]+"."+a[1]&&(r++,o+="&p["+r+"][c]="+e.util.urlencode(a[0]),o+="&p["+r+"][n]="+e.util.urlencode(a[1]),1==a[4]&&(o+="&p["+r+"][d]=Y"),n=a[0]+"."+a[1]),o+="&p["+r+"][v]["+e.util.urlencode(a[2])+"]="+e.util.urlencode(a[3]);return o.substr(1)},e.ajax.history={expected_hash:"",obParams:null,obFrame:null,obImage:null,obTimer:null,bInited:!1,bHashCollision:!1,bPushState:!(!history.pushState||!e.type.isFunction(history.pushState)),init:function(t){if(!e.ajax.history.bInited){this.obParams=t;var o=this.obParams.getState();e.ajax.history.bPushState?(e.ajax.history.expected_hash=a.location.pathname,a.location.search&&(e.ajax.history.expected_hash+=a.location.search),e.ajax.history.put(o,e.ajax.history.expected_hash),e.bind(a,"popstate",e.ajax.history.__hashListener)):(e.ajax.history.expected_hash=a.location.hash,e.ajax.history.expected_hash&&"#"!=e.ajax.history.expected_hash||(e.ajax.history.expected_hash="__bx_no_hash__"),u.put(e.ajax.history.expected_hash,o),e.ajax.history.obTimer=setTimeout(e.ajax.history.__hashListener,500),e.browser.IsIE()?(e.ajax.history.obFrame=document.createElement("IFRAME"),e.hide_object(e.ajax.history.obFrame),document.body.appendChild(e.ajax.history.obFrame),e.ajax.history.obFrame.contentWindow.document.open(),e.ajax.history.obFrame.contentWindow.document.write(e.ajax.history.expected_hash),e.ajax.history.obFrame.contentWindow.document.close()):e.browser.IsOpera()&&(e.ajax.history.obImage=document.createElement("IMG"),e.hide_object(e.ajax.history.obImage),document.body.appendChild(e.ajax.history.obImage),e.ajax.history.obImage.setAttribute("src","javascript:location.href = 'javascript:BX.ajax.history.__hashListener();';"))),e.ajax.history.bInited=!0}},__hashListener:function(t){if(t=t||a.event||{state:!1},e.ajax.history.bPushState&&t.state)e.ajax.history.obParams.setState(t.state);else{if(e.ajax.history.obTimer&&(a.clearTimeout(e.ajax.history.obTimer),e.ajax.history.obTimer=null),null!=e.ajax.history.obFrame)var o=e.ajax.history.obFrame.contentWindow.document.body.innerText;else var o=a.location.hash;if(o&&"#"!=o||(o="__bx_no_hash__"),0==o.indexOf("#")&&(o=o.substring(1)),o!=e.ajax.history.expected_hash){var r=u.get(o);if(r&&(e.ajax.history.obParams.setState(r),e.ajax.history.expected_hash=o,null!=e.ajax.history.obFrame)){var n="__bx_no_hash__"==o?"":o;a.location.hash!=n&&a.location.hash!="#"+n&&(a.location.hash=n)}}e.ajax.history.obTimer=setTimeout(e.ajax.history.__hashListener,500)}},put:function(t,o,r){this.bPushState?history.pushState(t,"",o):(o="undefined"!=typeof r?r:"view"+o,u.put(o,t),e.ajax.history.expected_hash=o,a.location.hash=e.util.urlencode(o),null!=e.ajax.history.obFrame&&(e.ajax.history.obFrame.contentWindow.document.open(),e.ajax.history.obFrame.contentWindow.document.write(o),e.ajax.history.obFrame.contentWindow.document.close()))},checkRedirectStart:function(t,o){var r=a.location.hash;"#"==r.substring(0,1)&&(r=r.substring(1));var n=r.substring(0,5);"view/"!=n&&"view%"!=n||(e.ajax.history.bHashCollision=!0,document.write('<div id="__ajax_hash_collision_'+o+'" style="display: none;">'))},checkRedirectFinish:function(t,o){document.write("</div>");var r=a.location.hash;"#"==r.substring(0,1)&&(r=r.substring(1)),e.ready(function(){var a=r.substring(0,5);if("view/"==a||"view%"==a){var n=e("__ajax_hash_collision_"+o),s=n.firstChild;e.cleanNode(s),n.style.display="block","view%"!=a&&(r=e.util.urlencode(r)),r+=(r.indexOf("%3F")==-1?"%3F":"%26")+t+"="+o;var i="/bitrix/tools/ajax_redirector.php?hash="+r;e.ajax.insertToNode(i,s)}})}},e.ajax.component=function(a){this.node=a},e.ajax.component.prototype.getState=function(){var t={node:this.node,title:a.document.title,data:e(this.node).innerHTML},o=e("navigation");return null!=o&&(t.nav_chain=o.innerHTML),t},e.ajax.component.prototype.setState=function(a){e(a.node).innerHTML=a.data,e.ajax.UpdatePageTitle(a.title),a.nav_chain&&e.ajax.UpdatePageNavChain(a.nav_chain)};var u={arHistory:{},put:function(a,e){this.arHistory[a]=e},get:function(a){return this.arHistory[a]}};e.ajax.FormData=function(){this.elements=[],this.files=[],this.features={},this.isSupported(),this.log("BX FormData init")},e.ajax.FormData.isSupported=function(){var a=new e.ajax.FormData,t=a.features.supported;return a=null,t},e.ajax.FormData.prototype.log=function(a){},e.ajax.FormData.prototype.isSupported=function(){var e={};return e.fileReader=a.FileReader&&a.FileReader.prototype.readAsBinaryString,e.readFormData=e.sendFormData=!!a.FormData,e.supported=!(!e.readFormData||!e.sendFormData),this.features=e,this.log("features:"),this.log(e),e.supported},e.ajax.FormData.prototype.append=function(a,e){"object"==typeof e?this.files.push({name:a,value:e}):this.elements.push({name:a,value:e})},e.ajax.FormData.prototype.send=function(a,t,o,r){if(this.log("FD send"),this.xhr=e.ajax({method:"POST",dataType:"html",url:a,onsuccess:t,onfailure:r,start:!1,preparePost:!1}),o&&this.xhr.upload.addEventListener("progress",function(a){a.lengthComputable&&o(a.loaded/a.totalSize)},!1),this.features.readFormData&&this.features.sendFormData){var n=new FormData;this.log("use browser formdata");for(i in this.elements)n.append(this.elements[i].name,this.elements[i].value);for(i in this.files)n.append(this.files[i].name,this.files[i].value);this.xhr.send(n)}return this.xhr},e.addCustomEvent("onAjaxFailure",e.debug)}}(window);
//# sourceMappingURL=maps/core_ajax.js.map
